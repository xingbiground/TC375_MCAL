/*********************************************************
 *  StatusReport.c  : function description.  
 *  Revision History:
 *  ————————————————————————————
 *  Date          Version     Author      Detail
 *  2023-12-17    V1.0.0      LIN         
 *********************************************************/
 

/***********************************************************************************************************************
 *  INCLUDES
 **********************************************************************************************************************/
#include "StatusReport.h"
#include <string.h>
#include "lwip/stats.h"
#include "lwip/udp.h"
#include "Test_Print.h"
#include "AppCfg.h"

/***********************************************************************************************************************
 *  LOCAL CONSTANT MACROS
 **********************************************************************************************************************/


/***********************************************************************************************************************
 *  LOCAL FUNCTION MACROS
 **********************************************************************************************************************/


/***********************************************************************************************************************
 *  LOCAL DATA TYPES AND STRUCTURES
 **********************************************************************************************************************/
typedef struct udp_pcb udpPcb;
typedef struct pbuf pBuf;               /* Define a more convenient type                                            */

/***********************************************************************************************************************
 *  LOCAL DATA PROTOTYPES
 **********************************************************************************************************************/
udpPcb *udpTestPcb;
pBuf *udpBuffer;


/***********************************************************************************************************************
 *  GLOBAL DATA
 **********************************************************************************************************************/


/***********************************************************************************************************************
 *  LOCAL FUNCTION PROTOTYPES
 **********************************************************************************************************************/


/***********************************************************************************************************************
 *  LOCAL FUNCTIONS
 **********************************************************************************************************************/

void StatusReport_Init(void)
{
    ip_addr_t localIpAddr = {APPCFG_LOCALIPADDR};
    ip_addr_t remoteIpAddr = {APPCFG_UDPREMOTEIPADDR};
    uint8 TempStr[10] = {'H','E','L','L','O'};
    err_t ret = ERR_OK;

    udpTestPcb = udp_new();
    ret = udp_bind(udpTestPcb, &localIpAddr, APPCFG_UDPLOCALPORT_STATUSREPORT);
    if(ret == ret){
        udp_connect(udpTestPcb, &remoteIpAddr, APPCFG_UDPREMOTEPORT_STATUSREPORT);
    }
    udpBuffer = pbuf_alloc(PBUF_RAW, 255, PBUF_POOL);
    udpBuffer->tot_len = 10;
    udpBuffer->len = 10;
    MEMCPY(udpBuffer->payload, TempStr, 10);
}

void StatusReport_1000ms(void)
{
    err_t ret = ERR_OK;
    ret = udp_send(udpTestPcb, udpBuffer);
    if(ret == ERR_OK){
        /* do nothing */
    }else{
        print_f("UDP sent not OK\n");
    }
}



/***********************************************************************************************************************
 *  END OF FILE: StatusReport.c
 **********************************************************************************************************************/
